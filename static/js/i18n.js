// å¤šè¯­è¨€é…ç½®
const translations = {
    zh: {
        // é¡µé¢æ ‡é¢˜
        pageTitle: 'è‚¡ç¥¨äº¤æ˜“è®¡åˆ’ç®¡ç† - Wicked Stock Trading',
        
        // Tabæ ‡ç­¾
        mockTrading: 'ğŸ“ˆ æ¨¡æ‹Ÿäº¤æ˜“',
        tradingPlans: 'ğŸ“Š äº¤æ˜“è®¡åˆ’',
        autoRunning: 'è‡ªåŠ¨è¿è¡Œä¸­',
        running: 'è¿è¡Œä¸­',
        
        // æ¨¡æ‹Ÿäº¤æ˜“é¢æ¿
        totalEquity: 'æ€»æƒç›Š',
        cash: 'ç°é‡‘',
        marketValue: 'å¸‚å€¼',
        pnl: 'ç›ˆäº',
        equityCurve: 'ğŸ“Š æƒç›Šæ›²çº¿',
        recentRange: 'æœ€è¿‘',
        allRange: 'å…¨éƒ¨',
        positions: 'ğŸ“Š æŒä»“',
        recentTrades: 'ğŸ“‹ æœ€è¿‘äº¤æ˜“',
        
        // å·¦ä¾§é¢æ¿
        searchPlaceholder: 'æœç´¢è‚¡ç¥¨ä»£ç æˆ–åç§°...',
        
        // åŒºåŸŸæ ‡é¢˜
        starredSection: 'â­ é‡ç‚¹å…³æ³¨',
        trackingSection: 'ğŸ“‹ è·Ÿè¸ªä¸­',
        pausedSection: 'â¸ï¸ æš‚åœè·Ÿè¸ª',
        
        // ç©ºçŠ¶æ€
        emptyState: 'æš‚æ— äº¤æ˜“è®¡åˆ’',
        emptyHint: 'ä½¿ç”¨å³ä¾§ AI åŠ©æ‰‹ç”Ÿæˆäº¤æ˜“è®¡åˆ’',
        
        // æŒ‰é’®
        viewDetail: 'æŸ¥çœ‹è¯¦æƒ…',
        historyVersions: 'å†å²ç‰ˆæœ¬',
        
        // å¼¹çª—
        versionCount: 'ä¸ªç‰ˆæœ¬',
        latest: 'æœ€æ–°',
        stockName: 'è‚¡ç¥¨åç§°',
        recommendLevel: 'äº¤æ˜“æ¨èåº¦',
        spotPlanTitle: 'ç°è´§è®¡åˆ’',
        target: 'ç›®æ ‡',
        buyPrice: 'ä¹°å…¥ä»·',
        sellPrice: 'æ­¢ç›ˆä»·',
        stopLoss: 'æ­¢æŸä»·',
        profitRate: 'é¢„æœŸæ”¶ç›Šç‡',
        
        // é”™è¯¯æ¶ˆæ¯
        loadVersionsFailed: 'åŠ è½½ç‰ˆæœ¬å¤±è´¥',
        enterPassword: 'è¯·è¾“å…¥å¯†ç ',
        enterContent: 'è¯·è¾“å…¥äº¤æ˜“è®¡åˆ’å†…å®¹',
        saving: 'ä¿å­˜ä¸­...',
        
        // å³ä¾§é¢æ¿
        aiAssistant: 'ğŸ’¬ AI äº¤æ˜“åŠ©æ‰‹',
        unlockTitle: 'ğŸ”’ æˆæƒè®¿é—®',
        unlockHint: 'è¯·è¾“å…¥å¯†ç è§£é” AI äº¤æ˜“åŠ©æ‰‹',
        passwordPlaceholder: 'è¯·è¾“å…¥å¯†ç ',
        unlockBtnText: 'è§£é”',
        lockBtn: 'é”å®š',
        saveBtn: 'ğŸ’¾ ä¿å­˜äº¤æ˜“è®¡åˆ’',
        
        // Dify è¾“å…¥æç¤º
        difyInputPlaceholder: 'ä»ä¸Šæ–¹å¯¹è¯ä¸­å¤åˆ¶ AI ç”Ÿæˆçš„äº¤æ˜“è®¡åˆ’ç²˜è´´åˆ°è¿™é‡Œ...',
        
        // è®¡åˆ’æ ‡é¢˜
        spotPlan: 'ğŸ“ˆ ç°è´§è®¡åˆ’ï¼š',
        optionPlan: 'ğŸ“Š æœŸæƒè®¡åˆ’ï¼š',
        
        // æç¤ºä¿¡æ¯
        loading: 'åŠ è½½ä¸­...',
        unlockSuccess: 'è§£é”æˆåŠŸ',
        locked: 'å·²é”å®š',
        passwordError: 'å¯†ç é”™è¯¯ï¼Œå·²é‡æ–°é”å®š',
        saved: 'å·²ä¿å­˜',
        saveFailed: 'ä¿å­˜å¤±è´¥',
        
        // è¯­è¨€åˆ‡æ¢
        language: 'EN | ä¸­'
    },
    en: {
        // Page Title
        pageTitle: 'Stock Trading Plan Manager - Wicked Stock Trading',
        
        // Tab Labels
        mockTrading: 'ğŸ“ˆ Mock Trading',
        tradingPlans: 'ğŸ“Š Trading Plans',
        autoRunning: 'Auto Running',
        running: 'Running',
        
        // Mock Trading Panel
        totalEquity: 'Total Equity',
        cash: 'Cash',
        marketValue: 'Market Value',
        pnl: 'P&L',
        equityCurve: 'ğŸ“Š Equity Curve',
        recentRange: 'Recent',
        allRange: 'All',
        positions: 'ğŸ“Š Positions',
        recentTrades: 'ğŸ“‹ Recent Trades',
        
        // Left Panel
        searchPlaceholder: 'Search symbol or name...',
        
        // Section Headers
        starredSection: 'â­ Starred',
        trackingSection: 'ğŸ“‹ Tracking',
        pausedSection: 'â¸ï¸ Paused',
        
        // Empty State
        emptyState: 'No Trading Plans',
        emptyHint: 'Use AI assistant on the right to generate plans',
        
        // Buttons
        viewDetail: 'View Details',
        historyVersions: 'History',
        
        // Modal
        versionCount: 'versions',
        latest: 'Latest',
        stockName: 'Stock Name',
        recommendLevel: 'Recommendation',
        spotPlanTitle: 'Spot Trading',
        target: 'Target',
        buyPrice: 'Buy Price',
        sellPrice: 'Take Profit',
        stopLoss: 'Stop Loss',
        profitRate: 'Expected Return',
        
        // Error Messages
        loadVersionsFailed: 'Failed to load versions',
        enterPassword: 'Please enter password',
        enterContent: 'Please enter trading plan content',
        saving: 'Saving...',
        
        // Right Panel
        aiAssistant: 'ğŸ’¬ AI Trading Assistant',
        unlockTitle: 'ğŸ”’ Enter Password',
        unlockHint: 'Enter password to unlock AI Trading Assistant',
        passwordPlaceholder: 'Enter password',
        unlockBtnText: 'Unlock',
        lockBtn: 'Lock',
        saveBtn: 'ğŸ’¾ Save Plan',
        
        // Dify Input Placeholder
        difyInputPlaceholder: 'Copy AI-generated trading plan from the conversation above and paste here...',
        
        // Plan Titles
        spotPlan: 'ğŸ“ˆ Spot Trading:',
        optionPlan: 'ğŸ“Š Options Trading:',
        
        // Messages
        loading: 'Loading...',
        unlockSuccess: 'Unlocked successfully',
        locked: 'Locked',
        passwordError: 'Incorrect password, locked again',
        saved: 'Saved',
        saveFailed: 'Save failed',
        
        // Language Switcher
        language: 'ä¸­ | EN'
    }
};

// å›½é™…åŒ–ç®¡ç†ç±»
class I18n {
    constructor() {
        this.currentLang = localStorage.getItem('language') || 'zh';
        this.translations = translations;
        this.initLangSwitch();
    }
    
    initLangSwitch() {
        // ç­‰å¾… DOM åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            const langSwitch = document.querySelector('.lang-switch');
            const langSlider = document.getElementById('langSlider');
            const langOptions = document.querySelectorAll('.lang-option');
            
            if (!langSwitch || !langSlider) return;
            
            // åˆå§‹åŒ–æ»‘å—ä½ç½®
            this.updateSliderPosition();
            
            // ç‚¹å‡»æ•´ä¸ªåˆ‡æ¢æ¡†
            langSwitch.addEventListener('click', (e) => {
                if (e.target.classList.contains('lang-option')) {
                    const targetLang = e.target.getAttribute('data-lang');
                    if (targetLang && targetLang !== this.currentLang) {
                        this.switchLanguage(targetLang);
                    }
                } else {
                    // ç‚¹å‡»ç©ºç™½åŒºåŸŸï¼Œåˆ‡æ¢åˆ°å¦ä¸€ç§è¯­è¨€
                    this.toggleLanguage();
                }
            });
        });
    }
    
    updateSliderPosition() {
        const langSlider = document.getElementById('langSlider');
        const langOptions = document.querySelectorAll('.lang-option');
        
        if (!langSlider) return;
        
        // æ›´æ–°æ»‘å—ä½ç½®
        if (this.currentLang === 'en') {
            langSlider.classList.add('en');
        } else {
            langSlider.classList.remove('en');
        }
        
        // æ›´æ–°æ–‡å­—é«˜äº®
        langOptions.forEach(option => {
            const lang = option.getAttribute('data-lang');
            if (lang === this.currentLang) {
                option.classList.add('active');
            } else {
                option.classList.remove('active');
            }
        });
    }
    
    t(key) {
        return this.translations[this.currentLang][key] || key;
    }
    
    switchLanguage(lang) {
        if (this.translations[lang]) {
            this.currentLang = lang;
            localStorage.setItem('language', lang);
            this.updateSliderPosition();
            this.updateUI();
        }
    }
    
    toggleLanguage() {
        const newLang = this.currentLang === 'zh' ? 'en' : 'zh';
        this.switchLanguage(newLang);
    }
    
    updateUI() {
        // æ›´æ–°é¡µé¢æ ‡é¢˜
        document.title = this.t('pageTitle');
        document.documentElement.lang = this.currentLang === 'zh' ? 'zh-CN' : 'en';
        
        // æ›´æ–°æ‰€æœ‰å¸¦ data-i18n å±æ€§çš„å…ƒç´ 
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.t(key);
            
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translation;
            } else {
                element.textContent = translation;
            }
        });
        
        // è§¦å‘é‡æ–°æ¸²æŸ“
        if (window.tradingPlanManager) {
            window.tradingPlanManager.renderPlans();
        }
    }
    
    getCurrentLang() {
        return this.currentLang;
    }
}

// åˆ›å»ºå…¨å±€å®ä¾‹
window.i18n = new I18n();
