<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨äº¤æ˜“è®¡åˆ’ç®¡ç† - PB Fortune</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/trading_plans.css') }}?v=5.3">
</head>
<body>
    <!-- å…¨å±€å¤´éƒ¨ -->
    <header class="global-header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">ğŸ“ˆ</span>
                <span class="logo-text" id="tradingQuote">The market is never wrong - opinions are.</span>
            </div>
            <div class="lang-switch">
                <span class="lang-option" data-lang="zh">ä¸­</span>
                <div class="lang-slider" id="langSlider"></div>
                <span class="lang-option" data-lang="en">EN</span>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Left Panel: Trading Plans List -->
        <div class="left-panel">
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="mock-trading" data-i18n="mockTrading">ğŸ“ˆ æ¨¡æ‹Ÿäº¤æ˜“</button>
                <button class="tab-btn" data-tab="trading-plans" data-i18n="tradingPlans">ğŸ“Š äº¤æ˜“è®¡åˆ’</button>
            </div>
            
            <!-- Mock Trading Tab -->
            <div class="tab-content active" id="mockTradingTab">
                <div class="trading-control-panel" id="tradingControlPanel">
                    <div class="control-header">
                        <h3 data-i18n="mockTrading">ğŸ“ˆ æ¨¡æ‹Ÿäº¤æ˜“ <span style="font-size: 12px; color: #64748b;" data-i18n="autoRunning">(è‡ªåŠ¨è¿è¡Œä¸­)</span></h3>
                        <span class="status-badge running" id="monitorStatus" data-i18n="running">è¿è¡Œä¸­</span>
                    </div>
                    
                    <div class="account-summary" id="accountSummary">
                        <div class="summary-item">
                            <span class="label" data-i18n="totalEquity">æ€»æƒç›Š</span>
                            <span class="value" id="totalEquity">$100,000.00</span>
                        </div>
                        <div class="summary-item">
                            <span class="label" data-i18n="cash">ç°é‡‘</span>
                            <span class="value" id="cash">$100,000.00</span>
                        </div>
                        <div class="summary-item">
                            <span class="label" data-i18n="marketValue">å¸‚å€¼</span>
                            <span class="value" id="marketValue">$0.00</span>
                        </div>
                        <div class="summary-item pnl">
                            <span class="label" data-i18n="pnl">ç›ˆäº</span>
                            <span class="value" id="totalPnl">$0.00 (0.00%)</span>
                        </div>
                    </div>
                    
                    <!-- æ”¶ç›Šæ›²çº¿å›¾ -->
                    <div class="equity-chart-section">
                        <div class="equity-chart-header">
                            <h4 data-i18n="equityCurve">ğŸ“Š æƒç›Šæ›²çº¿</h4>
                            <div class="time-range-filter">
                                <button class="time-filter-btn active" data-range="default" data-i18n="recentRange">æœ€è¿‘</button>
                                <button class="time-filter-btn" data-range="all" data-i18n="allRange">å…¨éƒ¨</button>
                            </div>
                        </div>
                        <canvas id="equityChart"></canvas>
                    </div>
                    
                    <!-- Positions List -->
                    <div class="positions-section" id="positionsSection" style="display: none;">
                        <h4 data-i18n="positions">ğŸ“Š æŒä»“</h4>
                        <div class="positions-list" id="positionsList">
                            <!-- Positions will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Recent Trades -->
                    <div class="trades-section" id="tradesSection" style="display: none;">
                        <h4 data-i18n="recentTrades">ğŸ“‹ æœ€è¿‘äº¤æ˜“</h4>
                        <div class="trades-list" id="tradesList">
                            <!-- Trades will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Trading Plans Tab -->
            <div class="tab-content" id="tradingPlansTab">
                <div class="plans-header">
                    <div class="search-box">
                        <input type="text" id="searchInput" data-i18n="searchPlaceholder" placeholder="æœç´¢è‚¡ç¥¨ä»£ç æˆ–åç§°...">
                        <button id="searchBtn">ğŸ”</button>
                    </div>
                </div>
                
                <div class="plans-list" id="plansList">
                    <!-- Plans will be dynamically loaded here -->
                    <div class="loading" data-i18n="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Trading Records + AI Assistant -->
        <div class="right-panel">
            <!-- ç›‘æ§æ—¥å¿—åŒºåŸŸï¼ˆä¸Šæ–¹1/3ï¼‰ -->
            <div class="trading-records-section">
                <div class="monitor-console" id="monitorConsole">
                    <div class="console-loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            
            <!-- AI åŠ©æ‰‹åŒºåŸŸï¼ˆä¸‹æ–¹2/3ï¼‰ -->
            <div class="ai-assistant-section">
                <!-- è§£é”ç•Œé¢ -->
                <div class="unlock-overlay" id="unlockOverlay">
                    <div class="unlock-box">
                        <div style="text-align: center;">
                            <h2 id="unlockTitle" data-i18n="unlockTitle" style="margin-bottom: 10px; color: var(--color-text-primary); font-family: inherit;">æˆæƒè®¿é—®</h2>
                            <p id="unlockHint" data-i18n="unlockHint" style="color: var(--color-text-secondary); margin-bottom: 30px; font-family: inherit;">è¯·è¾“å…¥å¯†ç è§£é” AI äº¤æ˜“åŠ©æ‰‹</p>
                            <div style="margin-bottom: 20px;">
                                <input 
                                    type="password" 
                                    id="chatPasswordInput" 
                                    data-i18n="passwordPlaceholder"
                                    placeholder="è¯·è¾“å…¥å¯†ç "
                                    style="
                                        width: 100%;
                                        padding: 12px;
                                        border: 1px solid var(--color-border);
                                        border-radius: 0;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        font-family: inherit;
                                        background: var(--color-bg-secondary);
                                        color: var(--color-text-primary);
                                    "
                                />
                            </div>
                            <button id="chatUnlockBtn" data-i18n="unlockBtnText" class="btn" style="
                                width: 100%;
                                padding: 12px;
                                background: var(--macaron-lavender);
                                color: #000000;
                                border: 1px solid var(--macaron-lavender);
                                border-radius: 12px;
                                font-size: 14px;
                                font-weight: 600;
                                cursor: pointer;
                                font-family: inherit;
                            ">è§£é”</button>
                        </div>
                    </div>
                </div>
                
                <!-- èŠå¤©ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                <div id="chatContent" style="display: none; height: 100%; flex-direction: column;">
                    <div class="chat-header">
                        <span id="aiAssistantTitle" data-i18n="aiAssistant">ğŸ’¬ AI äº¤æ˜“åŠ©æ‰‹</span>
                        <button id="chatLockBtn" data-i18n="lockBtn" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px; font-family: inherit;">é”å®š</button>
                    </div>
                    
                    <div class="chatbot-container" id="chatbotContainer">
                        <iframe 
                            id="difyIframe"
                            src="{{ dify_url }}" 
                            style="width: 100%; height: 100%; border: none;"
                            allow="microphone">
                        </iframe>
                    </div>
                    
                    <div class="save-section">
                        <textarea id="planInput" data-i18n="difyInputPlaceholder" placeholder="ä»ä¸Šæ–¹å¯¹è¯ä¸­å¤åˆ¶ AI ç”Ÿæˆçš„äº¤æ˜“è®¡åˆ’ç²˜è´´åˆ°è¿™é‡Œ..." rows="4" style="font-family: inherit;"></textarea>
                        <button id="savePlanBtn" data-i18n="saveBtn" class="btn btn-save">ğŸ’¾ ä¿å­˜äº¤æ˜“è®¡åˆ’</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Plan Detail Modal -->
    <div id="planModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>



    <script src="{{ url_for('static', filename='js/i18n.js') }}?v=2.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/mock_trading.js') }}?v=2.9"></script>
    <script src="{{ url_for('static', filename='js/trading_plans.js') }}?v=2.4"></script>
    <script>
        // åˆå§‹åŒ–è¯­è¨€
        document.addEventListener('DOMContentLoaded', () => {
            window.i18n.updateUI();
            initDailyQuote();
        });
        
        // é‡‘èäº¤æ˜“åè¨€åˆ—è¡¨
        const tradingQuotes = [
            "The market is never wrong - opinions are.",
            "Cut your losses short and let your profits run.",
            "The trend is your friend until the end when it bends.",
            "Risk comes from not knowing what you're doing.",
            "In investing, what is comfortable is rarely profitable.",
            "The stock market is a device for transferring money from the impatient to the patient.",
            "Price is what you pay, value is what you get.",
            "The four most dangerous words in investing are: 'This time it's different.'",
            "Markets can remain irrational longer than you can remain solvent.",
            "Never invest in a business you cannot understand.",
            "The big money is not in the buying or selling, but in the waiting.",
            "Successful investing is about managing risk, not avoiding it.",
            "Don't look for the needle in the haystack. Just buy the haystack.",
            "The investor's chief problem - and even his worst enemy - is likely to be himself.",
            "Time in the market beats timing the market."
        ];
        
        function initDailyQuote() {
            const quoteElement = document.getElementById('tradingQuote');
            if (!quoteElement) return;
            
            // æ ¹æ®æ—¥æœŸé€‰æ‹©åè¨€ï¼ˆæ¯å¤©å›ºå®šä¸€å¥ï¼‰
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            const quoteIndex = dayOfYear % tradingQuotes.length;
            
            quoteElement.textContent = tradingQuotes[quoteIndex];
        }
    </script>
</body>
</html>
